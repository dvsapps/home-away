webpackJsonp([8],{115:function(e,c,a){var d;void 0!==(d=function(g){g=a(2);var d=a(1),h=a(116),b=a(5);return a(13),a(23),g.View.extend({tagName:"div",className:"modal fade",template:h,initialize:function(b){d.bindAll(this);this.render(b.templateData);this.name=b.name||""},render:function(b){return this.$el.html(this.template(b)),this.$el.addClass(b.classes),this},show:function(){return this.$el.modal({show:!0,backdrop:!0}),b.trigger("generic.modal",{modalname:this.name,modalaction:"open"}),this},
hide:function(){return this.$el.modal("hide"),b.trigger("generic.modal",{modalname:this.name,modalaction:"close"}),this}})}.call(c,a,c,e))&&(e.exports=d)},116:function(e,c,a){c=a(3);e.exports=(c["default"]||c).template({1:function(a,g,c,h){var b,f;return'            \x3cdiv class\x3d"modal-header"\x3e\n                \x3cbutton type\x3d"button" class\x3d"close" data-dismiss\x3d"modal" aria-hidden\x3d"true"\x3e\x26times;\x3c/button\x3e\n                \x3ch3 class\x3d"modal-title"\x3e'+(null!=(f=
null!=(f=g.heading||(null!=a?a.heading:a))?f:g.helperMissing,b="function"==typeof f?f.call(a,{name:"heading",hash:{},data:h}):f)?b:"")+"\x26nbsp\x3c/h3\x3e\n            \x3c/div\x3e\n"},3:function(a,g,c,h){var b,f;return'            \x3cdiv class\x3d"modal-footer"\x3e'+(null!=(f=null!=(f=g.footer||(null!=a?a.footer:a))?f:g.helperMissing,b="function"==typeof f?f.call(a,{name:"footer",hash:{},data:h}):f)?b:"")+"\x3c/div\x3e\n"},compiler:[6,"\x3e\x3d 2.0.0-beta.1"],main:function(a,g,c,h){var b,f;return'\x3cdiv class\x3d"modal-dialog"\x3e\n    \x3cdiv class\x3d"modal-content"\x3e\n'+
(null!=(b=g["if"].call(a,null!=a?a.heading:a,{name:"if",hash:{},fn:this.program(1,h,0),inverse:this.noop,data:h}))?b:"")+'        \x3cdiv class\x3d"modal-body"\x3e'+(null!=(f=null!=(f=g.body||(null!=a?a.body:a))?f:g.helperMissing,b="function"==typeof f?f.call(a,{name:"body",hash:{},data:h}):f)?b:"")+"\x3c/div\x3e\n\n"+(null!=(b=g["if"].call(a,null!=a?a.footer:a,{name:"if",hash:{},fn:this.program(3,h,0),inverse:this.noop,data:h}))?b:"")+"    \x3c/div\x3e\n\x3c/div\x3e\n"},useData:!0})},234:function(e,
c,a){var d;void 0!==(d=function(g){var c=a(2),h=a(1),b=a(17),f=a(8),d=a(9);return a(28),c.Model.extend({defaults:{rating:0,headline:void 0,body:void 0,arrivalDateString:void 0},urlRoot:"/ajax/review/",url:function(){return this.urlRoot+this._spu},validate:function(a){var b={status:!1,messages:[],errorElements:[]};if(a=a||this.attributes,void 0===a.headline&&(b.status=!0,b.messages.push("Headline is required"),b.errorElements.push("headline")),void 0===a.rating?(b.status=!0,b.messages.push("Rating is required"),
b.errorElements.push("rating")):(!h.isNumber(a.rating)||1>a.rating||5<a.rating)&&(b.status=!0,b.messages.push("Rating must be a whole number between 1 and 5, inclusive"),b.errorElements.push("rating")),void 0===a.arrivalDateString&&(b.status=!0,b.messages.push("Arrival date is required"),b.errorElements.push("arrivalDateString")),void 0===a.body&&(b.status=!0,b.messages.push("Body is required"),b.errorElements.push("body")),void 0!==a.reviewSignature&&(void 0===a.reviewSignatureDate&&(b.status=!0,
b.messages.push("Review signature date is required"),b.errorElements.push("reviewSignatureDate")),void 0===a.reviewSignatureEmail&&(b.status=!0,b.messages.push("Review signature email is required"),b.errorElements.push("reviewSignatureEmail"))),b.status)return this.validationError=b,b;this.validationError=null},getFormattedBody:function(){return h.escape(this.get("body")).replace(/(\r\n|\n|\r)/gm,"\x3cbr /\x3e")},formattedCreatedDate:function(){var a=this.formatDate(this.attributes.createdDate);return b.formatDateFromISO8601ToMedium(a)},
formattedArrivalDate:function(){var a=this.formatDate(this.attributes.arrivalDate);return b.formatDateFromISO8601ToMonthNameYear(a)},formatDate:function(a){var b;return a?(b=f(a),b.get("year")+"-"+(b.get("month")+1)+"-"+b.get("date")):a},save:function(a,b,g){var f;null===a||"object"==typeof a?(f=a,g=b):(f={})[a]=b;g=h.extend({beforeSend:this.beforeSend},g);c.Model.prototype.save.call(this,f,g)},beforeSend:function(a){var b=ha.util.guid();d.set(ha.api.csrfTokenName,b);a.setRequestHeader("csrf_check",
b)}})}.call(c,a,c,e))&&(e.exports=d)},32:function(e,c,a){var d;void 0!==(d=function(){return{isLocalStorageSupported:function(){var a;try{return a=window.sessionStorage,a.setItem("iOSPrivateModeTest","1"),a.removeItem("iOSPrivateModeTest"),"localStorage"in window&&null!==window.localStorage}catch(c){return!1}}(),setItem:function(a,c){this.isLocalStorageSupported&&localStorage.setItem(a,c)},removeItem:function(a){this.isLocalStorageSupported&&localStorage.removeItem(a)},getItem:function(a){return this.isLocalStorageSupported?
localStorage.getItem(a):null},clear:function(){if(this.isLocalStorageSupported)return localStorage.clear()}}}.call(c,a,c,e))&&(e.exports=d)},458:function(e,c,a){var d;void 0!==(d=function(g){g=a(19);var c=a(66),h=a(234),b=a(21),f=a(46),d=a(459);a(67);a(29);new c({module:"writeReview"});c=new h(g.review);c._spu=g.listing.spu;new d({el:"body",model:c,travelerModel:b,unitModel:new f(g.listing)})}.call(c,a,c,e))&&(e.exports=d)},459:function(e,c,a){var d;void 0!==(d=function(c){var d=a(1),h=a(460),b=a(462),
f=a(52),e=a(5);return a(42),a(39),a(13),f.extend({initialize:function(a){f.prototype.initialize.apply(this,[a]);d.extend(this,d.pick(a,"travelerModel","unitModel"));this.initializeFormView();this.unveilReviewPhotos()},initializeFormView:function(){return this.formView=new h({el:".js-writeReviewView",model:this.model,travelerModel:this.travelerModel}),this.listenTo(this.formView,"success",this.renderSuccess),this},unveilReviewPhotos:function(){this.$(".js-unveilReviewerImg").unveil()},renderSuccess:function(a){this.successView=
new b({model:a,travelerModel:this.travelerModel,unitModel:this.unitModel});e.trigger("listing.review.submit");this.successView.render()}})}.call(c,a,c,e))&&(e.exports=d)},46:function(e,c,a){var d;void 0!==(d=function(c){var d=a(1);c=a(2);var h=a(47);return c.Model.extend({urlRoot:"/api/property/unit/",idAttribute:"spu",keys:{availabilityCalendar:"availabilityCalendar",availabilityUpdated:"availabilityUpdated",dataStore:"dataStore",detailPageUrl:"detailPageUrl",chequesVacancesAccepted:"chequesVacancesAccepted",
clearstayBookable:"clearstayBookable",contact:"contact",images:"images",numBookingsInLast12Months:"numBookingsInLast12Months",onlineBookable:"onlineBookable",ownerManaged:"ownerManaged",payPerBooking:"payPerBooking",petsAllowed:"petsAllowed",propertyApiUrl:"propertyApiUrl",quotable:"quotable",rateSummary:"rateSummary",usesTravelerCheckout:"usesTravelerCheckout",reviewCount:"reviewCount",spu:"spu",thirdPartyBaseBookingUrl:"thirdPartyBaseBookingUrl",videoUrls:"videoUrls"},defaults:{cancellationRefundPolicyPeriods:null,
integratedPropertyManager:!1,unitRentalPolicy:null},parse:function(a){return a.images=new h(a.images),a},initialize:function(){this.set({images:new h(this.getImages())})},isStaleCalendarDisplayAllowed:function(){return!(this.getOnlineBookable()||this.getPayPerBooking())},hasQuotableRates:function(){return this.get(this.keys.quotable)},hasEmail:function(){var a=this.getContact();return a&&a.hasEmail},usesTravelerCheckout:function(){return this.get("usesTravelerCheckout")},getAcceptsCreditCards:function(){return this.get("acceptsCreditCards")},
getAcceptsHomeAwayPayments:function(){return this.get("acceptsHomeAwayPayments")},getAcceptsOfflinePayments:function(){return this.get("acceptsOfflinePayments")},getAvailabilityCalendar:function(){return this.get("availabilityCalendar")},getAvailabilityUpdated:function(){return this.get("availabilityUpdated")},getCancellationRefundPolicyPeriods:function(){var a=this.getUnitRentalPolicy();return a?a.cancellationRefundPolicyPeriods:null},getChequesVacancesAccepted:function(){return this.get("chequesVacancesAccepted")},
getClearstayBookable:function(){return this.get("clearstayBookable")},getContact:function(){return this.get("contact")},getContactNumberByTitle:function(a){return d.find(this.getContact().phones,function(c){return c.phoneType===a})},getFax:function(){return this.getContactNumberByTitle("fax")},getGeoCode:function(){return this.get("geoCode")},getImages:function(){return this.get("images")},getIntegratedPropertyManager:function(){return this.get("integratedPropertyManager")},getOnlineBookable:function(){return this.get("onlineBookable")},
getOwnerManaged:function(){return this.get("ownerManaged")},getNumBookingsInLast12Months:function(){return this.get("numBookingsInLast12Months")},getPayPerBooking:function(){return this.get("payPerBooking")},getPetsAllowed:function(){return!this.getOnlineBookable()||this.get("petsAllowed")},getPhones:function(){return this.getContact().phones},getPrimaryPhoneNumber:function(){return this.getContactNumberByTitle("Primary")},getPropertyApiUrl:function(){return this.get("propertyApiUrl")},getQuotable:function(){return this.get("quotable")},
getRateSummary:function(){return this.get("rateSummary")||{}},getRateSummaryRentNights:function(){var a=this.getRateSummary();return{rates:a.rentNights||{},beginDate:a.beginDate||{},endDate:a.endDate||{}}},getSecondaryPhoneNumber:function(){return this.getContactNumberByTitle("Secondary")},getSleeps:function(){return this.get("sleeps")},getSpu:function(){return this.get("spu")},getTertiaryPhoneNumber:function(){return this.getContactNumberByTitle("Tertiary")},getThirdPartyBaseBookingUrl:function(){return this.get("thirdPartyBaseBookingUrl")},
getUnitId:function(){return this.getSpu().split("-")[2]},getSystemId:function(){return this.getSpu().split("-")[0]},getUnitRentalPolicy:function(){return this.get("unitRentalPolicy")},getVideoUrls:function(){return this.get("videoUrls")},equals:function(a){return a&&this.getSpu()===a.getSpu()},takesInquiries:function(){return this.get("takesInquiries")}})}.call(c,a,c,e))&&(e.exports=d)},460:function(e,c,a){(function(d){var g;void 0!==(g=function(c){var h=a(0),b=a(1);c=a(2);var f=a(29),g=a(32),d=a(6);
return a(104),a(132),a(77),a(12),a(461),a(25),c.View.extend({events:{"change input[data-model-attr]":"changeFormInput","change textarea[data-model-attr]":"changeFormInput","click .js-ratingStar":"rate",submit:"submitReview"},selectors:{bodyCounterContainer:".js-bodyCounterContainer",titleCounterContainer:".js-titleCounterContainer",reviewBody:".js-reviewBody",reviewTitle:".js-reviewTitle",datepicker:".js-singleDatepicker",submitButton:".js-submitReview",whyLoginPopoverTrigger:".js-whyLoginPopoverTrigger",
formGroupsWithErrors:".form-group.has-error"},initialize:function(a){var c=d.read("property.review.review_body.maxlength")+' \x3cspan class\x3d"remainder"\x3e%left\x3c/span\x3e';b.bindAll(this);this.travelerModel=a.travelerModel;this.restorePersistedReview(this.model._spu,this.model)?(this.populateInputsFromModel(this.model),this.travelerModel&&this.travelerModel.isLoggedIn()&&this.submitReview()):0<this.model.get("rating")&&this.populateInputsFromModel(this.model);this.$(this.selectors.datepicker).datepicker({minDate:"-1y",
maxDate:"-1",startOfWeek:ha.i18n.startOfWeek,language:ha.i18n.calendar,dateFormat:ha.i18n.dateFormats.shortDate});this.$(this.selectors.datepicker).on("changed",this.changeFormInput);this.$(this.selectors.whyLoginPopoverTrigger).popover({html:!0,title:d.read("property.review.login.benefits.header"),content:d.read("property.review.login.benefits.body"),placement:"top",trigger:"hover"});this.$(this.selectors.reviewBody).maxlength({counterContainer:this.$(this.selectors.bodyCounterContainer),text:c});
this.$(this.selectors.reviewTitle).maxlength({counterContainer:this.$(this.selectors.titleCounterContainer),text:c})},populateInputsFromModel:function(a){var c=this;!function(a){b.each(a,function(a,f){var g=c.$("[name\x3d"+f+"]"),d=g.is(":radio");b.isString(a)&&!d?g.val(a):d&&(c.$(".js-ratingStars").addClass("rating-stars-"+a),g.prop("checked",function(){return 1*h(this).val()===a}))})}(a.attributes)},changeFormInput:function(a){a=h(a.currentTarget);var b=a.attr("data-model-attr"),c=a.val();"checkbox"===
a.attr("type")||"radio"===a.attr("type")?("rating"===a.attr("data-model-attr")&&(c*=1),this.model.set(b,c)):this.model.set(b,c)},rate:function(a){a=h(a.currentTarget);var b=a.parent(),c=a.attr("data-rating");a.find("input").prop("checked",!0).trigger("change");b.attr("class","rating-stars js-ratingStars").addClass("rating-stars-"+c)},submitReview:function(a){var b,c={success:this.saveSuccess,error:this.saveError},f=this.model.has("reviewSignature");return a&&(a.preventDefault(),a.stopPropagation()),
this.indicateProgress(),this.clearErrors(),b=this.model.validate(!1),this.isValid(b)?f||this.travelerModel&&this.travelerModel.isLoggedIn()?this.model.save({},c):(this.persistReview(this.model._spu,this.model),this.redirectToLogin()):this.showErrors(b.errorElements),!1},isValid:function(a){return!(a&&a.status)},showErrors:function(a){this.stopProgress();for(var b=0;b<a.length;b++)this.$("input[data-model-attr\x3d"+a[b]+"], textarea[data-model-attr\x3d"+a[b]+"]").closest(".form-group").addClass("has-error")},
clearErrors:function(){this.$(this.selectors.formGroupsWithErrors).removeClass("has-error")},saveSuccess:function(a){if(this.stopProgress(),void 0!==window.waTrackGTReview)try{window.waTrackGTReview()}catch(b){}this.trigger("success",a)},saveError:function(a,c){var f=JSON.parse(c.responseText);this.showErrors(b.keys(f))},redirectToLogin:function(){f.launchStandaloneLogin("review")},indicateProgress:function(){this.$(this.selectors.submitButton).button("loading")},stopProgress:function(){this.$(this.selectors.submitButton).button("reset")},
persistReview:function(a,b){return!!g.isLocalStorageSupported&&(localStorage.setItem("propertyReview"+a,JSON.stringify(b.toJSON())),!0)},restorePersistedReview:function(a,b){var c,f="propertyReview"+a;return!!(g.isLocalStorageSupported&&(c=localStorage.getItem(f))&&c.length)&&(b.set(JSON.parse(c)),localStorage.removeItem(f),!0)}})}.call(c,a,c,e))&&(e.exports=g)}).call(c,a(0))},461:function(e,c,a){(function(a){!function(a){a.fn.maxlength=function(c){var h=a(this);return h.each(function(){c=a.extend({},
{counterContainer:!1,text:"%left characters left"},c);var b=a(this),b={options:c,field:b,counter:a('\x3cdiv class\x3d"maxlength"\x3e\x3c/div\x3e'),maxLength:parseInt(b.attr("maxlength"),10),lastLength:null,updateCounter:function(){var b=this.field.val().replace(/\r\n/g,"~~").replace(/\n/g,"~~").length,c=this.options.text.replace(/\B%(length|maxlength|left)\b/g,a.proxy(function(a,c){return"length"==c?b:"maxlength"==c?this.maxLength:this.maxLength-b},this));this.counter.html(c);b!=this.lastLength&&
this.updateLength(b)},updateLength:function(a){this.field.trigger("update.maxlength",[this.field,this.lastLength,a,this.maxLength,this.maxLength-a]);this.lastLength=a}};b.maxLength&&(b.field.data("maxlength",b).bind({"keyup change":function(b){a(this).data("maxlength").updateCounter()},"cut paste drop":function(b){setTimeout(a.proxy(function(){a(this).data("maxlength").updateCounter()},this),1)}}),c.counterContainer?c.counterContainer.append(b.counter):b.field.after(b.counter),b.updateCounter())}),
h}}(a)}).call(c,a(0))},462:function(e,c,a){(function(d){var g;void 0!==(g=function(c){var h=a(0),b=a(1);c=a(2);var f=a(115),d=a(463),g=a(464),e=a(6);return a(13),c.View.extend({modalHiddenEvent:"hidden.bs.modal",initialize:function(a){b.bindAll(this);this.travelerModel=a.travelerModel;this.unitModel=a.unitModel},render:function(){return this.successModal=new f({templateData:{classes:"review-confirmation",heading:e.read("property.review.thanks.for.your.review"),body:d({review:this.model}),footer:g()},
name:"writeReviewSuccess"}),h("body").append(this.successModal.el),this.showModal(),this},showModal:function(){this.successModal.show().$el.on(this.modalHiddenEvent,this.redirectToPropertyPage)},redirectToPropertyPage:function(){window.location=this.unitModel.get(this.unitModel.keys.detailPageUrl)},createShareHash:function(a,c,h){var f=a.keys,d=a.get(f.spu).split("-");return{kind:"review",name:b.escape(c.get("headline")),description:b.escape(c.get("body")),listing:{id:d[1],system:d[0],site:a.get(f.dataStore)},
review:{uuid:c.get("uuid")},user:{uuid:h.get("uuid")}}},shareSuccessCallback:function(){this.showModal()}})}.call(c,a,c,e))&&(e.exports=g)}).call(c,a(0))},463:function(e,c,a){c=a(3);e.exports=(c["default"]||c).template({compiler:[6,"\x3e\x3d 2.0.0-beta.1"],main:function(a,c,e,h){var b;return'\x3cp class\x3d"what-to-expect"\x3e'+(null!=(b=(c.message||a&&a.message||c.helperMissing).call(a,"property.review.thanks.text",{name:"message",hash:{},data:h}))?b:"")+"\x3c/p\x3e\n"},useData:!0})},464:function(e,
c,a){c=a(3);e.exports=(c["default"]||c).template({compiler:[6,"\x3e\x3d 2.0.0-beta.1"],main:function(a,c,e,h){var b;return'\x3cdiv class\x3d"text-center"\x3e'+(null!=(b=(c.message||a&&a.message||c.helperMissing).call(a,"property.review.profile.text",{name:"message",hash:{},data:h}))?b:"")+"\x3c/div\x3e"},useData:!0})},47:function(e,c,a){var d;void 0!==(d=function(c){c=a(2);var d=a(1);return c.Collection.extend({getImagesByWidth:function(a,b){return this._getImagesByDimension(a,this.getImageFileByWidth,
b)},getImagesByHeight:function(a,b){return this._getImagesByDimension(a,this.getImageFileByHeight,b)},getImageFileByWidth:function(a,b){var c,e=d.filter(a,function(a){return a.width>=b});return e.length?(c=d.sortBy(e,function(a){return a.width}),c[0]):this.getLargestImageFileByWidth(a)},getImageFileByHeight:function(a,b){var c,e=d.filter(a,function(a){return a.height>=b});return e.length?(c=d.sortBy(e,function(a){return a.height}),c[0]):this.getLargestImageFileByHeight(a)},getLargestImagesByWidth:function(){var a,
b,c=[];return this.each(function(e){a=e.get("imageFiles");a.length&&(b=d.clone(this.getLargestImageFileByWidth(a)),b.note=e.get("note"),c.push(b))},this),c},getLargestImageFileByWidth:function(a){return d.sortBy(a,function(a){return a.width}).pop()},getLargestImageFileByHeight:function(a){return d.sortBy(a,function(a){return a.height}).pop()},_getImagesByDimension:function(a,b,c){var e,g,k=[];return this.each(function(c){e=c.get("imageFiles");e.length&&(g=d.clone(b.call(this,e,a)),g.note=c.get("note"),
g.altText=c.get("altText"),k.push(g))},this),c&&(k=d.filter(k,function(a){return a.height&&a.width})),k}})}.call(c,a,c,e))&&(e.exports=d)}},[458]);
//# sourceMappingURL=../2B/75626F40EC464FA07C5FAFC73BE108-writeReview.js.map